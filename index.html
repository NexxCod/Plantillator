<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador de Informes - Plantillador</title>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <header>
        <div class="wrap toolbar">
            <label class="btn" for="fileTpl">üìÑ Cargar plantilla</label>
            <input id="fileTpl" type="file" accept=".txt,text/plain" />
            <button id="saveTplBtn" title="Guardar el contenido del cuadro de plantilla con un nombre">üíæ Guardar
                plantilla</button>
            <button id="clearTplBtn" title="Borra el contenido de la plantilla actual">üßπ Limpiar plantilla</button>
            <div class="spacer"></div>
            <button id="settingsBtn" title="Configurar palabras excluidas">‚öôÔ∏è</button>
            <button id="compareBtn">Comparar</button>
            <button id="copyBtn" title="Copiar salida">üìã</button>
            <button id="clearReportBtn" title="Limpia el informe del residente y la salida">üßπ Limpiar informe</button>
        </div>
    </header>

    <main>
        <section class="card">
            <h2>Plantillas guardadas</h2>
            <div id="tplList" class="list" aria-live="polite"></div>
            <p class="small">Las plantillas se guardan localmente en tu navegador usando <code>localStorage</code> y
                permanecer√°n disponibles al volver a abrir.</p>
        </section>

        <section class="card">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <div>
                    <h2>PLANTILLA (formato base)</h2>
                    <textarea id="templateTxt" placeholder="Pega aqu√≠ la PLANTILLA base‚Ä¶"></textarea>
                </div>
                <div>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <h2>INFORME DEL RESIDENTE</h2>
                        <button id="recoverReportBtn" class="btn-icon"
                            title="Recuperar √∫ltimo informe guardado">‚Ü∫</button>
                    </div>
                    <textarea id="reportTxt" placeholder="Pega aqu√≠ el INFORME del residente‚Ä¶"></textarea>
                    <div>
                        <button id="micReportBtn" class="mic-btn"
                            title="Dictar al informe (Web Speech). Atajo: Mant√©n presionado 'Alt'">
                            üé§
                            <span class="mic-dot" style="display:none;"></span>
                        </button>
                        <span class="mic-hint">Atajo: Mant√©n presionada la tecla <b>Alt</b> para hablar.</span>
                    </div>
                </div>
            </div>

            <h2 style="margin-top:14px;">SALIDA (frases distintas EN MAY√öSCULAS)</h2>
            <div id="outputTxt" class="output" tabindex="0" aria-readonly="true" role="textbox" aria-multiline="true"
                placeholder="Aqu√≠ aparecer√° la salida‚Ä¶"></div>

            <div id="metrics" class="metrics">
                <button id="editOutBtn" title="Editar la salida con control de cambios">Editar salida</button>
                <span class="pill">Frases en informe: <b id="mTotal">0</b></span>
                <span class="pill warn">Frases con cambios: <b id="mChanged">0</b></span>
                <span class="pill good">% cambio (frases): <b id="mPct">0%</b></span>
            </div>
        </section>
    </main>

    <div id="editorModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" data-close="1"></div>
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="edTitle">
            <header class="modal-head">
                <h2 id="edTitle">Editor de salida (control de cambios)</h2>
                <button class="icon-btn" id="edClose" title="Cerrar">‚úï</button>
            </header>

            <div class="modal-toolbar">
                <button id="edMicBtn" class="mic-btn"
                    title="Dictar en el editor (Web Speech). Atajo: Mant√©n presionado 'Alt'">
                    üé§
                    <span class="mic-dot" style="display:none;"></span>
                </button>
                <button id="edUseBase"
                    title="Fija el texto actual como la versi√≥n 'original' para la comparaci√≥n visual">Limpiar
                    resaltados</button>
                <label title="Conservar l√≠neas que terminen en ':' al normalizar">
                    <input type="checkbox" id="edKeepHeads" checked> Mantener encabezados (l√≠neas con ‚Äú:‚Äù)
                </label>
                <div class="spacer"></div>
                <button id="edNormalize"
                    title="Quita MAY√öSCULAS, aplica sentence case y respeta siglas">Normalizar</button>
                <button id="edCopy" title="Copiar texto plano del editor">üìã</button>
                <button id="edSaveBack" class="primary"
                    title="Restaura el texto a c√≥mo estaba cuando se abri√≥ el editor">Restaurar original</button>
            </div>

            <div id="edEditor" class="editor" contenteditable="true" spellcheck="false"
                aria-label="Editor con control de cambios"></div>
        </div>
    </div>

    <div id="settingsModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop" data-close="1"></div>
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="settingsTitle"
            style="max-width: 600px;">
            <header class="modal-head">
                <h2 id="settingsTitle">Configuraci√≥n</h2>
                <button class="icon-btn" id="settingsClose" title="Cerrar">‚úï</button>
            </header>
            <div style="padding: 12px 16px; display:flex; flex-direction:column; gap:12px; flex:1; min-height:0;">
                <div class="setting-row">
                    <div>
                        <h4>Modo de Dictado (Tecla `Alt`)</h4>
                        <p class="small" style="margin:0;">Elige c√≥mo se activa el micr√≥fono con la
                            tecla `Alt`.</p>
                    </div>
                    <div class="switch-container">
                        <span class="switch-label">Pulsar y mantener</span>
                        <label class="switch">
                            <input type="checkbox" id="dictationModeToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Alternar (On/Off)</span>
                    </div>
                </div>
                <hr style="border-color: var(--border); margin: 8px 0;">
                <h3>Palabras excluidas de la comparaci√≥n</h3>
                <p class="small" style="margin: -8px 0 0 0;">
                    Lista de siglas o palabras (una por l√≠nea) que se ignorar√°n al editar. √ötil para t√©rminos como
                    "LIRADS", "IV", etc.
                </p>
                <textarea id="excludedWordsTxt" style="min-height: 200px; flex:1;"></textarea>
                <div class="modal-toolbar" style="padding:0; border:none;">
                    <label class="btn" for="settingsLoadFile">Cargar archivo</label>
                    <input id="settingsLoadFile" type="file" accept=".txt,text/plain,.json,application/json" />
                    <button id="settingsDownloadBtn">Descargar</button>
                    <div class="spacer"></div>
                    <button id="settingsSave" class="primary">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>


    <footer>
        Plantillador ¬© 2025 Marcelo Salinas Villagra ¬∑ Versi√≥n 1.0
    </footer>
    <div id="toast" aria-live="polite" aria-atomic="true"></div>
    <script type="module" src="./js/app.js"></script>
</body>

</html>